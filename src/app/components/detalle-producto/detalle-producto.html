<div class="modal-backdrop" *ngIf="isOpen" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <!-- Botón cerrar -->
    <button class="btn-close" (click)="cerrar()" aria-label="Cerrar">
      <i class="fas fa-times"></i>
    </button>

    <!-- Loading State -->
    <div *ngIf="loading" class="modal-loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="modal-error">
      <i class="fas fa-exclamation-circle fa-3x text-danger mb-3"></i>
      <h5>Error al cargar el producto</h5>
      <p>No se pudo cargar la información del producto. Por favor, intenta nuevamente.</p>
      <button class="btn btn-primary" (click)="cerrar()">Cerrar</button>
    </div>

    <!-- Product Content -->
    <div *ngIf="producto && !loading && !error" class="modal-content-wrapper">
      <div class="row">
        <!-- Galería de imágenes -->
        <div class="col-md-6">
          <div class="imagen-principal">
            <img [src]="producto.imagenes[imagenActual]" [alt]="producto.nombre" />
          </div>
          <div class="imagenes-miniaturas" *ngIf="producto.imagenes.length > 1">
            <div 
              *ngFor="let imagen of producto.imagenes; let i = index"
              class="miniatura"
              [class.active]="i === imagenActual"
              (click)="cambiarImagen(i)">
              <img [src]="imagen" [alt]="producto.nombre + ' - ' + (i + 1)" />
            </div>
          </div>
        </div>

        <!-- Información del producto -->
        <div class="col-md-6">
          <div class="producto-info">
            <h2 class="producto-nombre">{{ producto.nombre }}</h2>
            
            <div class="rating mb-3">
              <span [innerHTML]="generarEstrellas(producto.rating)"></span>
              <span class="ms-2">({{ producto.rating }})</span>
            </div>

            <div class="precio-container">
              <span class="precio">${{ formatearPrecio(producto.precio) }}</span>
            </div>

            <div class="stock-info" [class.sin-stock]="producto.stock === 0">
              <i class="fas fa-box me-2"></i>
              {{ producto.stock > 0 ? producto.stock + ' disponibles' : 'Sin stock' }}
            </div>

            <div class="descripcion" *ngIf="producto.descripcion">
              <h5>Descripción</h5>
              <p>{{ producto.descripcion }}</p>
            </div>

            <div class="cantidad-selector" *ngIf="producto.stock > 0">
              <label>Cantidad:</label>
              <div class="cantidad-controls">
                <button 
                  class="btn btn-cantidad" 
                  (click)="decrementarCantidad()"
                  [disabled]="cantidad <= 1">
                  <i class="fas fa-minus"></i>
                </button>
                <input type="number" 
                       class="form-control cantidad-input" 
                       [(ngModel)]="cantidad"
                       [max]="producto.stock"
                       min="1"
                       readonly />
                <button 
                  class="btn btn-cantidad" 
                  (click)="incrementarCantidad()"
                  [disabled]="cantidad >= producto.stock">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>

            <div class="modal-actions">
              <button 
                class="btn-agregar-carrito"
                (click)="agregarAlCarrito()"
                [disabled]="producto.stock === 0">
                <i class="fas fa-shopping-cart me-2"></i>
                {{ producto.stock === 0 ? 'Sin Stock' : 'Agregar al Carrito' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>